<!-- 第1段：优化后的个人信息区域 -->
<view class="user-info-card">
  <!-- 宝宝信息 - 紧凑布局 -->
  <view class="baby-info-compact">
    <!-- 头像 -->
    <view class="avatar-section">
      <view class="avatar">
        <image wx:if="{{babyInfo.avatarUrl}}" src="{{babyInfo.avatarUrl}}" class="avatar-image"></image>
        <text wx:else class="avatar-text">{{babyInfo.name ? babyInfo.name.substring(0,1) : '宝'}}</text>
      </view>
    </view>
    
    <!-- 宝宝信息和妈妈能量 -->
    <view class="info-section">
      <!-- 第一行：宝宝名字和编辑按钮 -->
      <view class="name-edit-row">
        <view class="name-age">
          <text class="baby-name">{{babyInfo.name || '宝宝'}}</text>
          <text class="baby-age">· {{babyInfo.age || '0岁0个月'}}</text>
        </view>
        <view class="edit-btn" bindtap="editBabyInfo">
          <text class="edit-icon">✏️</text>
          <text class="edit-text">编辑</text>
        </view>
      </view>
      
      <!-- 第二行：妈妈能量 -->
      <view class="energy-row">
        <text class="energy-label">妈妈能量</text>
        <view class="energy-stars">
          <text class="star {{babyInfo.energyRating >= 1 ? 'active' : ''}}">★</text>
          <text class="star {{babyInfo.energyRating >= 2 ? 'active' : ''}}">★</text>
          <text class="star {{babyInfo.energyRating >= 3 ? 'active' : ''}}">★</text>
          <text class="star {{babyInfo.energyRating >= 4 ? 'active' : ''}}">★</text>
          <text class="star {{babyInfo.energyRating >= 5 ? 'active' : ''}}">★</text>
        </view>
        <text class="energy-desc">能量满满</text>
      </view>
    </view>
  </view>

  <!-- 签到区域 -->
  <view class="checkin-section">
    <!-- 签到按钮 -->
    <view class="checkin-btn" bindtap="handleCheckin">
      <text class="btn-icon">✨</text>
      <text class="btn-text">今日签到</text>
    </view>
    
    <!-- 签到天数 -->
    <view class="checkin-stats">
      <text class="stats-icon">📅</text>
      <text class="stats-text">已坚持记录 {{checkinDays}} 天</text>
    </view>
  </view>
</view>

<!-- 签到成功提示 -->
<view class="toast-message {{showToast ? 'show' : ''}}">
  <text class="toast-icon">✅</text>
  <text class="toast-text">签到成功！+1天</text>
</view>
<!-- 第2段：关心宝贝功能区 -->
<view class="care-section">
  <view class="care-title">❤️ 关心宝贝</view>
  <view class="function-grid">
    <view class="function-item" bindtap="navToBabyStatus">
      <view class="function-icon">📊</view>
      <text class="function-text">我宝情况</text>
    </view>

    <view class="function-item" bindtap="navToDietRecord">
      <view class="function-icon">🍽️</view>
      <text class="function-text">饮食记录</text>
    </view>

    <view class="function-item" bindtap="navToMap">
      <view class="function-icon">🗺️</view>
      <text class="function-text">看看周围</text>
    </view>

    <view class="function-item" bindtap="navToDiary">
      <view class="function-icon">📔</view>
      <text class="function-text">心情日记</text>
    </view>
  </view>
</view>

<!-- 第3段：状态评分 - 简洁版 -->
<view class="chart-section" bindtap="navToSymptomHistory">
  <view class="chart-header">
    <!-- 改为一行显示，标题和描述在同一行 -->
    <text class="chart-title">📊 状态评分</text>
    <text class="chart-desc">依据我宝情况·数据仅供参考
    今日分数: {{currentHealthIndex}}</text>
  </view>

  <!-- 折线图保持不变 -->
  <view class="compact-chart">
    <!-- 图表区域 -->
    <view class="chart-area">
      <block wx:for="{{healthTrendData}}" wx:key="date">
        <view class="chart-column" style="left: {{(10 + 20 * index)}}%;">
          <!-- 分数显示在点上方 -->
          <text class="score-text {{currentHealthIndex === item.healthIndex ? 'current-score' : 'other-score'}}">
            {{item.healthIndex}}
          </text>
          <!-- 数据点 -->
          <view 
            class="chart-dot {{item.healthIndex < 60 ? 'low-dot' : ''}} {{currentHealthIndex === item.healthIndex ? 'active-dot' : ''}}" 
            style="bottom: {{item.healthIndex}}%;">
          </view>
        </view>
      </block>
    </view>
    
    <!-- 日期显示 -->
    <view class="dates-display">
      <block wx:for="{{healthTrendData}}" wx:key="date">
        <view class="date-column" style="left: {{(10 + 20 * index)}}%;">
          <text class="date-label {{currentHealthIndex === item.healthIndex ? 'current-date' : ''}}">
            {{item.displayDate}}
          </text>
        </view>
      </block>
    </view>
  </view>
</view>

<!-- 第4段：今日快速记录 - 添加缺失的容器 -->
<view class="quick-record-section">
  <view class="section-header">
    <view class="section-title">📝 今日快速记录</view>
    <view class="history-entry" bindtap="navToQuickRecordHistory">
      <text class="history-text">历史记录</text>
      <text class="history-icon">›</text>
    </view>
  </view>
  
  <!-- 快速记录入口 -->
  <view class="quick-actions">
    <view class="action-item {{todayEmotion ? 'recorded' : ''}}" bindtap="quickRecord" data-type="mood">
      <view class="action-icon">
        <text wx:if="{{todayEmotion === 1}}">😊</text>
        <text wx:if="{{todayEmotion === 2}}">😐</text>
        <text wx:if="{{todayEmotion === 3}}">😢</text>
        <text wx:if="{{!todayEmotion}}">😊</text>
      </view>
      <text class="action-text">情绪</text>
      <text class="action-desc" wx:if="{{todayEmotion}}">{{getEmotionText(todayEmotion)}}</text>
      <text class="action-placeholder" wx:else>点击记录</text>
    </view>
    
    <view class="action-item {{todayExercise ? 'recorded' : ''}}" bindtap="quickRecord" data-type="exercise">
      <view class="action-icon">🏃</view>
      <text class="action-text">运动</text>
      <text class="action-desc" wx:if="{{todayExercise}}">{{todayExercise}}分钟</text>
      <text class="action-placeholder" wx:else>点击记录</text>
    </view>
    
    <view class="action-item {{todaySleep ? 'recorded' : ''}}" bindtap="quickRecord" data-type="sleep">
      <view class="action-icon">
        <text wx:if="{{todaySleep === 1}}">😴</text>
        <text wx:if="{{todaySleep === 2}}">😊</text>
        <text wx:if="{{todaySleep === 3}}">🤩</text>
        <text wx:if="{{!todaySleep}}">😴</text>
      </view>
      <text class="action-text">睡眠</text>
      <text class="action-desc" wx:if="{{todaySleep}}">{{getSleepText(todaySleep)}}</text>
      <text class="action-placeholder" wx:else>点击记录</text>
    </view>
  </view>
</view>

<!-- 第5段：经验交流预览（美化版） -->
<view class="experience-section">
  <!-- 头部 -->
  <view class="experience-header">
    <view class="experience-header-left">
      <view class="experience-title-row">
        <view class="experience-title-bar"></view>
        <text class="experience-title">🤝 经验交流</text>
      </view>
      <text class="experience-subtitle">妈妈们的真实经验分享</text>
    </view>

    <view class="experience-more-wrap" bindtap="goToExperienceList">
      <text class="experience-more-text">更多</text>
      <text class="experience-more-arrow">›</text>
    </view>
  </view>

  <!-- 有帖子时：展示几条热门经验 -->
  <block wx:if="{{hotPosts && hotPosts.length}}">
    <block wx:for="{{hotPosts}}" wx:key="id">
      <view class="experience-card" bindtap="goToExperienceList">
        <view class="card-title-row">
          <text class="card-title">{{item.title}}</text>
        </view>

        <view class="card-meta-row">
          <text class="card-author">{{item.author}}</text>
        </view>

        <view class="card-stat-row">
          <view class="card-stat">
            <text class="card-stat-icon">👍</text>
            <text class="card-stat-text">{{item.likes || 0}}</text>
          </view>
          <view class="card-stat">
            <text class="card-stat-icon">💪</text>
            <text class="card-stat-text">{{item.cheers || 0}}</text>
          </view>
        </view>
      </view>
    </block>
  </block>

  <!-- 没有帖子时 -->
  <block wx:else>
    <view class="experience-empty">
      <text class="empty-title">还没有经验分享</text>
      <text class="empty-text">可以在「经验交流」里发布第一条经验～</text>
    </view>
  </block>
</view>

<!-- 和我聊聊 -->
<view class="chat-section">
  <view class="chat-card">
    <view class="chat-left">
      <view class="chat-title-row">
        <text class="chat-emoji">🙋‍♀️</text>
        <text class="chat-title">和我聊聊</text>
      </view>
      <text class="chat-subtitle">
        希望「敏宝日记」这个记录工具能帮你：
        • 更清晰地了解孩子的状况
        • 更从容地面对每一天
        • 更科学地记录成长点滴
      </text>
    </view>

    <view class="chat-right" bindtap="openChatModal">
      <text class="chat-btn-text">和我联系</text>
    </view>
  </view>
</view>

<!-- 企业微信二维码弹层 -->
<view 
  class="chat-modal-mask" 
  wx:if="{{showChatModal}}" 
  catchtouchmove="true"
>
  <view class="chat-modal">
    <view class="chat-modal-header">
      <text class="chat-modal-title">和我联系</text>
      <text class="chat-modal-close" bindtap="closeChatModal">✕</text>
    </view>

    <view class="chat-modal-body">
      <text class="chat-modal-desc">
        截图 / 保存后，扫一扫添加好友。
      </text>

      <!-- 替换为二维码图片 -->
  <image src="/images/contact-qrcode.jpg" mode="aspectFit" class="qrcode-image"></image>
    </view>

    <button class="chat-modal-btn" bindtap="closeChatModal">
      我知道了
    </button>
  </view>
</view>
<!-- 快速记录弹窗 -->
<view class="quick-record-modal" wx:if="{{showQuickRecordModal}}">
  <view class="modal-mask" bindtap="closeQuickRecordModal"></view>
  <view class="modal-content">
    
    <!-- 情绪记录 -->
    <view class="record-panel" wx:if="{{quickRecordType === 'emotion'}}">
      <view class="panel-header">
        <text class="panel-title">今日情绪</text>
        <text class="panel-close" bindtap="closeQuickRecordModal">✕</text>
      </view>
      
      <view class="emotion-options">
        <view 
          class="emotion-option {{selectedEmotion === 1 ? 'selected' : ''}}" 
          bindtap="selectEmotion" 
          data-level="1"
        >
          <text class="emotion-icon">😊</text>
          <text class="emotion-text">开心</text>
        </view>
        
        <view 
          class="emotion-option {{selectedEmotion === 2 ? 'selected' : ''}}" 
          bindtap="selectEmotion" 
          data-level="2"
        >
          <text class="emotion-icon">😐</text>
          <text class="emotion-text">平静</text>
        </view>
        
        <view 
          class="emotion-option {{selectedEmotion === 3 ? 'selected' : ''}}" 
          bindtap="selectEmotion" 
          data-level="3"
        >
          <text class="emotion-icon">😢</text>
          <text class="emotion-text">不开心</text>
        </view>
      </view>
    </view>
    
    <!-- 运动记录 -->
    <view class="record-panel" wx:elif="{{quickRecordType === 'exercise'}}">
      <view class="panel-header">
        <text class="panel-title">运动时长</text>
        <text class="panel-close" bindtap="closeQuickRecordModal">✕</text>
      </view>
      
      <view class="exercise-options">
        <view 
          class="exercise-option {{selectedExercise === 30 ? 'selected' : ''}}" 
          bindtap="selectExercise" 
          data-minutes="30"
        >
          <text class="exercise-text">30分钟</text>
        </view>
        
        <view 
          class="exercise-option {{selectedExercise === 60 ? 'selected' : ''}}" 
          bindtap="selectExercise" 
          data-minutes="60"
        >
          <text class="exercise-text">1小时</text>
        </view>
        
        <view 
          class="exercise-option {{selectedExercise === 90 ? 'selected' : ''}}" 
          bindtap="selectExercise" 
          data-minutes="90"
        >
          <text class="exercise-text">1.5小时</text>
        </view>
        
        <view 
          class="exercise-option {{selectedExercise === 120 ? 'selected' : ''}}" 
          bindtap="selectExercise" 
          data-minutes="120"
        >
          <text class="exercise-text">2小时</text>
        </view>
        
        <view 
          class="exercise-option {{selectedExercise === 180 ? 'selected' : ''}}" 
          bindtap="selectExercise" 
          data-minutes="180"
        >
          <text class="exercise-text">更多</text>
        </view>
      </view>
    </view>
    
    <!-- 睡眠记录 -->
    <view class="record-panel" wx:elif="{{quickRecordType === 'sleep'}}">
      <view class="panel-header">
        <text class="panel-title">睡眠时长</text>
        <text class="panel-close" bindtap="closeQuickRecordModal">✕</text>
      </view>
      
      <view class="sleep-options">
        <view 
          class="sleep-option {{selectedSleep === 1 ? 'selected' : ''}}" 
          bindtap="selectSleep" 
          data-level="1"
        >
          <text class="sleep-icon">😴</text>
          <text class="sleep-text">低于8小时</text>
          <text class="sleep-desc">睡眠不足</text>
        </view>
        
        <view 
          class="sleep-option {{selectedSleep === 2 ? 'selected' : ''}}" 
          bindtap="selectSleep" 
          data-level="2"
        >
          <text class="sleep-icon">😊</text>
          <text class="sleep-text">8-10小时</text>
          <text class="sleep-desc">充足睡眠</text>
        </view>
        
        <view 
          class="sleep-option {{selectedSleep === 3 ? 'selected' : ''}}" 
          bindtap="selectSleep" 
          data-level="3"
        >
          <text class="sleep-icon">🤩</text>
          <text class="sleep-text">10小时以上</text>
          <text class="sleep-desc">优质睡眠</text>
        </view>
      </view>
    </view>
    
    <!-- 按钮区域 -->
    <view class="modal-actions">
      <button class="btn-cancel" bindtap="closeQuickRecordModal">取消</button>
      <button class="btn-confirm" bindtap="saveQuickRecord">确定</button>
    </view>
    
  </view>
</view>