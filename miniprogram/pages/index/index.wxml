<!-- 第1段：优化后的个人信息区域 -->
<view class="user-info-card">
  <!-- 宝宝信息 - 紧凑布局 -->
  <view class="baby-info-compact">
    <!-- 头像 -->
    <view class="avatar-section">
      <view class="avatar">
        <image wx:if="{{babyInfo.avatarUrl}}" src="{{babyInfo.avatarUrl}}" class="avatar-image"></image>
        <text wx:else class="avatar-text">{{babyInfo.name ? babyInfo.name.substring(0,1) : '宝'}}</text>
      </view>
    </view>
    
    <!-- 宝宝信息和妈妈能量 -->
    <view class="info-section">
      <!-- 第一行：宝宝名字和编辑按钮 -->
      <view class="name-edit-row">
        <view class="name-age">
          <text class="baby-name">{{babyInfo.name || '宝宝'}}</text>
          <text class="baby-age">· {{babyInfo.age || '0岁0个月'}}</text>
        </view>
        <view class="edit-btn" bindtap="editBabyInfo">
          <text class="edit-icon">✏️</text>
          <text class="edit-text">编辑</text>
        </view>
      </view>
      
      <!-- 第二行：妈妈能量 -->
      <view class="energy-row">
        <text class="energy-label">妈妈能量</text>
        <view class="energy-stars">
          <text class="star {{babyInfo.energyRating >= 1 ? 'active' : ''}}">★</text>
          <text class="star {{babyInfo.energyRating >= 2 ? 'active' : ''}}">★</text>
          <text class="star {{babyInfo.energyRating >= 3 ? 'active' : ''}}">★</text>
          <text class="star {{babyInfo.energyRating >= 4 ? 'active' : ''}}">★</text>
          <text class="star {{babyInfo.energyRating >= 5 ? 'active' : ''}}">★</text>
        </view>
        <text class="energy-desc">能量满满</text>
      </view>
    </view>
  </view>

  <!-- 签到区域 -->
  <view class="checkin-section">
    <!-- 签到按钮 -->
    <view class="checkin-btn" bindtap="handleCheckin">
      <text class="btn-icon">✨</text>
      <text class="btn-text">今日签到</text>
    </view>
    
    <!-- 签到天数 -->
    <view class="checkin-stats">
      <text class="stats-icon">📅</text>
      <text class="stats-text">已坚持记录 {{checkinDays}} 天</text>
    </view>
  </view>
</view>

<!-- 第2段：关心宝贝功能区 -->
<view class="care-section">
  <view class="care-title">❤️ 关心宝贝</view>
  <view class="function-grid">
    <view class="function-item" bindtap="navToBabyStatus">
      <view class="function-icon">👶</view>
      <text class="function-text">我宝近况</text>
    </view>

    <view class="function-item" bindtap="navToDietRecord">
      <view class="function-icon">🍽️</view>
      <text class="function-text">饮食记录</text>
    </view>

    <view class="function-item" bindtap="navToMap">
      <view class="function-icon">🗺️</view>
      <text class="function-text">看看周围</text>
    </view>

    <view class="function-item" bindtap="navToDiary">
      <view class="function-icon">📔</view>
      <text class="function-text">心情日记</text>
    </view>
  </view>
</view>

<!-- 第3段：状态评分 - 简洁版 -->
<!-- 状态评分图表区域 - 移除绿色填充 -->
<view class="chart-section" bindtap="navToSymptomHistory">
  <view class="chart-header">
    <view class="chart-title-row">
      <text class="chart-title">状态评分</text>
      <text class="chart-subtitle">数据仅供参考</text>
    </view>
    <view class="today-score">
      <text class="today-score-text">今日分数：{{currentHealthIndex}}</text>
    </view>
  </view>

  <!-- 图表主体 -->
  <view class="chart-area">
    <view class="chart-content">
      <!-- 图表网格 -->
      <view class="chart-grid">
        <view class="grid-line" wx:for="{{5}}" wx:key="index"></view>
      </view>
      
      <!-- 折线图 - 移除 chart-line-path 元素 -->
      <view class="chart-line">
        <view wx:for="{{healthTrendData}}" wx:key="date" class="chart-point" 
              style="left: {{item.position}}%; bottom: {{item.scorePosition}}%;">
          <text class="point-value">{{item.healthIndex}}</text>
          <view class="chart-dot {{item.healthIndex < 60 ? 'low-dot' : ''}} {{currentHealthIndex === item.healthIndex ? 'active-dot' : ''}}"></view>
        </view>
        <!-- 移除这行：<view class="chart-line-path health-line"></view> -->
      </view>
    </view>
    
    <!-- X轴日期 -->
    <view class="x-axis">
      <view wx:for="{{healthTrendData}}" wx:key="date" class="x-axis-label" style="left: {{item.position}}%;">
        <text class="x-axis-date">{{item.displayDate}}</text>
      </view>
    </view>
  </view>
</view>

<!-- 第4段：今日快速记录 - 简化版 -->
<view class="quick-record-section">
  <view class="section-header">
    <view class="section-title">📝 今日快速记录</view>
    <view class="history-entry" bindtap="navToQuickRecordHistory">
      <text class="history-text">历史记录</text>
      <text class="history-icon">›</text>
    </view>
  </view>
  
  <!-- 快速记录入口 -->
  <view class="quick-actions">
    <!-- 情绪记录 -->
    <view class="action-item" bindtap="quickRecord" data-type="mood">
      <view class="action-icon">
        <text wx:if="{{todayEmotion === 1}}">😊</text>
        <text wx:if="{{todayEmotion === 2}}">😐</text>
        <text wx:if="{{todayEmotion === 3}}">😢</text>
        <text wx:if="{{!todayEmotion}}">😊</text>
      </view>
      <text class="action-text">情绪</text>
    </view>
    
    <!-- 运动记录 - 根据时长显示不同图标 -->
    <view class="action-item" bindtap="quickRecord" data-type="exercise">
      <view class="action-icon">
        <text wx:if="{{todayExercise === 'under30'}}">🪑</text>
        <text wx:elif="{{todayExercise === '30-60'}}">🚶</text>
        <text wx:elif="{{todayExercise === '1-2'}}">🏃</text>
        <text wx:elif="{{todayExercise === 'over2'}}">🌟</text>
        <text wx:else>🚶</text>
      </view>
      <text class="action-text">运动</text>
    </view>
    
    <!-- 睡眠记录 - 根据时长显示不同图标 -->
    <view class="action-item" bindtap="quickRecord" data-type="sleep">
      <view class="action-icon">
        <text wx:if="{{todaySleep === 1}}">😫</text>
        <text wx:elif="{{todaySleep === 2}}">😊</text>
        <text wx:elif="{{todaySleep === 3}}">🤩</text>
        <text wx:else>😴</text>
      </view>
      <text class="action-text">睡眠</text>
    </view>
    
    <!-- 电子产品使用记录 - 根据时长显示不同图标 -->
    <view class="action-item" bindtap="quickRecord" data-type="screentime">
      <view class="action-icon">
        <text wx:if="{{todayScreenTime === 0}}">👁️</text>
        <text wx:elif="{{todayScreenTime === 15}}">👀</text>
        <text wx:elif="{{todayScreenTime === 45}}">🥺</text>
        <text wx:elif="{{todayScreenTime === 90}}">😵</text>
        <text wx:else>📱</text>
      </view>
      <text class="action-text">电子产品</text>
    </view>
  </view>
</view>

<!-- 第5段：经验交流预览（美化版） -->
<view class="experience-section">
  <!-- 头部 -->
  <view class="experience-header">
    <view class="experience-header-left">
      <view class="experience-title-row">
        <view class="experience-title-bar"></view>
        <text class="experience-title">🤝 经验交流</text>
      </view>
      <text class="experience-subtitle">妈妈们的真实经验分享</text>
    </view>

    <view class="experience-more-wrap" bindtap="goToExperienceList">
      <text class="experience-more-text">查看全部</text>
      <text class="experience-more-arrow">›</text>
    </view>
  </view>

  <!-- 有帖子时：展示几条热门经验 -->
  <block wx:if="{{hotPosts && hotPosts.length > 0}}">
    <view wx:for="{{hotPosts}}" wx:key="id" class="experience-card" bindtap="goToExperienceList" data-id="{{item.id}}">
      <view class="card-title-row">
        <text class="card-title">{{item.title}}</text>
      </view>

      <view class="card-meta-row">
        <text class="card-author">{{item.author}}</text>
      </view>

      <view class="card-stat-row">
        <view class="card-stat">
          <text class="card-stat-icon">👍</text>
          <text class="card-stat-text">{{item.likes || 0}}</text>
        </view>
        <view class="card-stat">
          <text class="card-stat-icon">💪</text>
          <text class="card-stat-text">{{item.cheers || 0}}</text>
        </view>
      </view>
    </view>
  </block>

  <!-- 没有帖子时 -->
  <block wx:else>
    <view class="experience-empty">
      <text class="empty-title">还没有经验分享</text>
      <text class="empty-text">可以在「经验交流」里发布第一条经验～</text>
    </view>
  </block>
</view>

<!-- 和我聊聊 -->
<view class="chat-section">
  <view class="chat-card">
    <view class="chat-left">
      <view class="chat-title-row">
        <text class="chat-emoji">🙋‍♀️</text>
        <text class="chat-title">和我聊聊</text>
      </view>
      <text class="chat-subtitle">
        希望「敏宝日记」这个记录工具能帮你：
        • 更清晰地了解孩子的状况
        • 更从容地面对每一天
        • 更科学地记录成长点滴
      </text>
    </view>

    <view class="chat-right" bindtap="openChatModal">
      <text class="chat-btn-text">和我联系</text>
    </view>
  </view>
</view>

<!-- 替换原来的二维码弹窗 -->
<view class="chat-modal-mask" wx:if="{{showChatModal}}" catchtouchmove="true">
  <view class="chat-modal">
    <view class="chat-modal-header">
      <text class="chat-modal-title">给我们留言</text>
      <text class="chat-modal-close" bindtap="closeChatModal">✕</text>
    </view>

    <view class="chat-modal-body">
      <text class="chat-modal-desc">
        欢迎提出宝贵建议，我们会认真阅读每一条留言
      </text>
      
      <!-- 留言表单 -->
      <view class="message-form">
        <textarea 
          class="message-textarea"
          placeholder="请输入您的留言"
          value="{{messageContent}}"
          bindinput="onMessageInput"
          maxlength="200"
          auto-height="false"
        ></textarea>
        <text class="char-count">{{messageContent.length}}/200</text>
      </view>
    </view>

    <view class="message-actions">
      <button class="message-btn message-btn-cancel" bindtap="closeChatModal">
        取消
      </button>
      <button class="message-btn message-btn-submit" bindtap="submitMessage" disabled="{{!messageContent || messageContent.length === 0}}">
  提交留言
</button>
    </view>
  </view>
</view>
<!-- 在快速记录弹窗中修改运动选项和添加电子产品选项 -->
<view class="quick-record-modal" wx:if="{{showQuickRecordModal}}">
  <view class="modal-mask" bindtap="closeQuickRecordModal"></view>
  <view class="modal-content">
    
    <!-- 情绪记录 -->
    <view class="record-panel" wx:if="{{quickRecordType === 'emotion'}}">
      <view class="panel-header">
        <text class="panel-title">今日情绪</text>
        <text class="panel-close" bindtap="closeQuickRecordModal">✕</text>
      </view>
      
      <view class="emotion-options">
        <view 
          class="emotion-option {{selectedEmotion === 1 ? 'selected' : ''}}" 
          bindtap="selectEmotion" 
          data-level="1"
        >
          <text class="emotion-icon">😊</text>
          <text class="emotion-text">开心</text>
        </view>
        
        <view 
          class="emotion-option {{selectedEmotion === 2 ? 'selected' : ''}}" 
          bindtap="selectEmotion" 
          data-level="2"
        >
          <text class="emotion-icon">😐</text>
          <text class="emotion-text">平静</text>
        </view>
        
        <view 
          class="emotion-option {{selectedEmotion === 3 ? 'selected' : ''}}" 
          bindtap="selectEmotion" 
          data-level="3"
        >
          <text class="emotion-icon">😢</text>
          <text class="emotion-text">不开心</text>
        </view>
      </view>
    </view>
    
   <!-- 修改：运动记录面板 -->
   <view class="record-panel" wx:elif="{{quickRecordType === 'exercise'}}">
      <view class="panel-header">
        <text class="panel-title">运动时长</text>
        <text class="panel-close" bindtap="closeQuickRecordModal">✕</text>
      </view>
      
      <view class="exercise-options">
        <view 
          class="exercise-option {{selectedExercise === 'under30' ? 'selected' : ''}}" 
          bindtap="selectExercise" 
          data-value="under30"
        >
          <text class="exercise-text">低于30分钟</text>
        </view>
        
        <view 
          class="exercise-option {{selectedExercise === '30-60' ? 'selected' : ''}}" 
          bindtap="selectExercise" 
          data-value="30-60"
        >
          <text class="exercise-text">30分钟-1小时</text>
        </view>
        
        <view 
          class="exercise-option {{selectedExercise === '1-2' ? 'selected' : ''}}" 
          bindtap="selectExercise" 
          data-value="1-2"
        >
          <text class="exercise-text">1-2小时</text>
        </view>
        
        <view 
          class="exercise-option {{selectedExercise === 'over2' ? 'selected' : ''}}" 
          bindtap="selectExercise" 
          data-value="over2"
        >
          <text class="exercise-text">大于2小时</text>
        </view>
      </view>
    </view>
    
    <!-- 睡眠记录 -->
    <view class="record-panel" wx:elif="{{quickRecordType === 'sleep'}}">
      <view class="panel-header">
        <text class="panel-title">睡眠时长</text>
        <text class="panel-close" bindtap="closeQuickRecordModal">✕</text>
      </view>
      
      <view class="sleep-options">
        <view 
          class="sleep-option {{selectedSleep === 1 ? 'selected' : ''}}" 
          bindtap="selectSleep" 
          data-level="1"
        >
          <text class="sleep-icon">😴</text>
          <text class="sleep-text">低于8小时</text>
          <text class="sleep-desc">睡眠不足</text>
        </view>
        
        <view 
          class="sleep-option {{selectedSleep === 2 ? 'selected' : ''}}" 
          bindtap="selectSleep" 
          data-level="2"
        >
          <text class="sleep-icon">😊</text>
          <text class="sleep-text">8-10小时</text>
          <text class="sleep-desc">充足睡眠</text>
        </view>
        
        <view 
          class="sleep-option {{selectedSleep === 3 ? 'selected' : ''}}" 
          bindtap="selectSleep" 
          data-level="3"
        >
          <text class="sleep-icon">🤩</text>
          <text class="sleep-text">10小时以上</text>
          <text class="sleep-desc">优质睡眠</text>
        </view>
      </view>
    </view>
    <!-- 修改：电子产品使用记录面板 -->
<view class="record-panel" wx:elif="{{quickRecordType === 'screentime'}}">
  <view class="panel-header">
    <text class="panel-title">📱 电子产品使用</text>
    <text class="panel-close" bindtap="closeQuickRecordModal">✕</text>
  </view>
  
  <view class="screentime-options">
    <view 
      class="screentime-option {{selectedScreenTime === 0 ? 'selected' : ''}}" 
      bindtap="selectScreenTime" 
      data-minutes="0"
    >
      <text class="screentime-text">0分钟</text>
    </view>
    
    <view 
      class="screentime-option {{selectedScreenTime === 15 ? 'selected' : ''}}" 
      bindtap="selectScreenTime" 
      data-minutes="15"
    >
      <text class="screentime-text">0-15分钟</text>
    </view>
    
    <view 
      class="screentime-option {{selectedScreenTime === 45 ? 'selected' : ''}}" 
      bindtap="selectScreenTime" 
      data-minutes="45"
    >
      <text class="screentime-text">15分钟-1小时</text>
    </view>
    
    <view 
      class="screentime-option {{selectedScreenTime === 90 ? 'selected' : ''}}" 
      bindtap="selectScreenTime" 
      data-minutes="90"
    >
      <text class="screentime-text">1小时以上</text>
    </view>
  </view>
</view>
    
    <!-- 按钮区域 -->
    <view class="modal-actions">
      <button class="btn-cancel" bindtap="closeQuickRecordModal">取消</button>
      <button class="btn-confirm" bindtap="saveQuickRecord">确定</button>
    </view>
  </view>
</view>

<!-- 协议弹窗 -->
<view class="agreement-modal" wx:if="{{showAgreementModal}}">
  <view class="agreement-mask" catchtap="closeAgreementModal"></view>
  
  <view class="agreement-content">
    <view class="agreement-header">
      <text class="agreement-title">用户协议与隐私政策</text>
      <text class="agreement-subtitle">
      请阅读并同意以下协议</text>
    </view>

    <!-- 授权信息区域 -->
    <view class="auth-info">
      <view class="info-item">• 记录宝宝成长数据</view>
      <view class="info-item">• 保存您的使用偏好</view>
      <view class="info-item">• 提供个性化服务</view>
    </view>

    <!-- 协议勾选区域 - 只有一个链接 -->
    <view class="agreement-check">
      <label class="checkbox-label" bindtap="toggleAgreementCheck">
        <checkbox 
          class="agreement-checkbox"
          checked="{{agreementChecked}}"
          color="#6A8BFF"
        />
        <text class="agreement-text">   我已阅读并同意
          <text class="link" catchtap="viewFullProtocol">《用户协议与隐私政策》</text>
        </text>
      </label>
    </view>

    <!-- 操作按钮 -->
    <view class="agreement-buttons">
      <button 
        class="agree-btn {{agreementChecked ? 'active' : ''}}" 
        bindtap="onAgreeAndLogin" 
        disabled="{{!agreementChecked}}"
      >
        {{agreementChecked ? '同意并继续' : '请先阅读协议'}}
      </button>
    </view>
  </view>
</view>